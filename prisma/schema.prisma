
generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

enum OrderStatus {
  PENDING
  PAID
  SHIPPED
  DELIVERED
  CANCELLED
}

model Category {
  id            Int       @id @default(autoincrement())
  name          String
  arabicName    String?   // REQUIRED for the "Silicon Shards" UI

  slug          String    @unique 
  description   String?
  imageUrl      String?
  products      Product[]
  
  // UI Meta: Allows the client to control the Bento Grid layout we built
  gridDisplay   String    @default("small") // "large", "tall", "medium", "small"

  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
}

model Product {
  id            Int         @id @default(autoincrement())
  name          String
  brand         String      @default("tech-souq") // Crucial for tech (ASUS, Intel, NVIDIA)
  description   String      @db.Text
  price         Decimal     @db.Decimal(10, 2)
  originalPrice Decimal?    @db.Decimal(10, 2) // For the "Discount" UI
  images        String[]   
  slug          String      @unique
  sku           String      @unique @default("none") // Stock Keeping Unit (Professional)
  
  // UI Flags we used in the components
  isFeatured    Boolean     @default(false)
  isNew         Boolean     @default(false)
  isActive      Boolean     @default(true)
  
  stock         Int         @default(0)
  
  // Technical Specifications (Structured)
  specs         ProductSpec[]

  // Trust/Social Signals
  averageRating Float       @default(0.0)
  reviewCount   Int         @default(0)

  category      Category    @relation(fields: [categoryId], references: [id])
  categoryId    Int
  
  orderItems    OrderItem[]
  cartItems     CartItem[] 
  
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
}

// 3. THE SPECIFICATION MODEL
// This allows for the "Technical Grid" we built in the PDP
model ProductSpec {
  id        Int     @id @default(autoincrement())
  label     String  // e.g., "VRAM", "Clock Speed", "Socket"
  value     String  // e.g., "24GB GDDR6X", "5.2GHz", "LGA1700"
  productId Int
  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)
}

model Cart {
  id            String @id @default(cuid())
  userId        String?    
  items         CartItem[]

  // If you add Auth later, you link this to User

  // user data
  first_name    String?
  last_name     String?
  email         String?
  address       String?

  discountId    Int?
  discount      Discount? @relation(fields: [discountId], references: [id])

  createdAt     DateTime @default(now())
}

model CartItem {
  id            Int         @id @default(autoincrement()) // Added distinct ID for easier UI handling
  productId     Int
  cartId        String

  product       Product     @relation(fields: [productId], references: [id])
  cart          Cart        @relation(fields: [cartId], references: [id], onDelete: Cascade)

  quantity      Int

  @@unique([productId, cartId])
}

model Order {
  id          String      @id @default(cuid()) // String IDs are better for Order lookup URLs
  orderNumber   String      @unique // e.g., TS-BBL-10024 (Babylon Tracking)

  // Guest Info
  firstName      String
  lastName       String
  email          String
  address        String
  city           String
  country        String     

  total          Decimal     @db.Decimal(10, 2)
  shippingCost   Decimal     @db.Decimal(10, 2) @default(0.00)
  status         OrderStatus @default(PENDING) 
  
  items          OrderItem[]

  trackingNumber String?     @unique
  carrier        String?     @default("Global Express")

  discountId     Int?
  discount       Discount?   @relation(fields: [discountId], references: [id])

  createdAt      DateTime    @default(now())
}

model OrderItem {
  id               Int      @id @default(autoincrement())
  orderId          String
  order            Order    @relation(fields: [orderId], references: [id])

  productId        Int
  product          Product  @relation(fields: [productId], references: [id])

  quantity         Int
  priceAt_time     Decimal  @db.Decimal(10, 2) // KEEP THIS: Snapshot price at time of order

  @@unique([orderId, productId])
}



model Discount {
  id        Int      @id @default(autoincrement())
  code      String   @unique
  value     Decimal  // Percentage or Fixed amount? Logic will be needed.

  isActive  Boolean  @default(true)
  expiresAt DateTime

  orders    Order[] 
  carts     Cart[]
  
  createdAt DateTime @default(now())
}
